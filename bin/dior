#!/usr/bin/env ruby

require 'curses'
require 'dior'
require 'dior/models/player'
require 'dior/views/player_view'
require 'dior/views/header_view'
require 'dior/views/input_view'

player = Dior::Player.new('spec/resources')

# Set up our screen
Curses.init_screen
Curses.noecho
Curses.crmode
Curses.stdscr.keypad(true)
Curses.clear

# Build our view objects
@player_view = Dior::PlayerView.new(player)
@header_view = Dior::HeaderView.new
@input_view  = Dior::InputView.new

def render_windows
  @header_view.show
  @player_view.show_main
  @input_view.show
end

# begin
  render_windows

  while c = @input_view.window.getch
    case c
    when 'q'
      Curses.close_screen
      break
    when ' '
      player.pause
    when 'h'
      @player_view.show_help
    end
  end
# ensure
#   Curses.close_screen
#   exit 0
# end

player.quit
